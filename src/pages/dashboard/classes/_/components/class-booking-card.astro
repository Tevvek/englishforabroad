---
import type { ClassBookingItem } from "../types";
import CancelClassButton from "./cancel-class-button";

interface Props {
  booking: ClassBookingItem;
  refundWindowHours: number;
}

const { booking, refundWindowHours } = Astro.props;

function getStatusClasses(status: ClassBookingItem["status"]) {
  if (status === "booked") {
    return "border-transparent bg-secondary text-secondary-foreground";
  }

  return "border border-input bg-background text-foreground";
}

function getStatusLabel(status: ClassBookingItem["status"]) {
  return status === "booked" ? "Booked" : "Cancelled";
}
---

<article class="rounded-lg border bg-card p-4">
  <div class="flex flex-wrap items-start justify-between gap-3">
    <div>
      <p class="text-base font-semibold">{booking.kstDateLabel}</p>
      <p class="mt-1 text-sm text-muted-foreground">{booking.kstTimeRangeLabel} (KST)</p>
    </div>
    <span
      class:list={[
        "inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium",
        getStatusClasses(booking.status),
      ]}
    >
      {getStatusLabel(booking.status)}
    </span>
  </div>

  {
    booking.status === "booked" && (
      <p class="mt-3 text-sm text-muted-foreground">
        {booking.isRefundEligible
          ? "Eligible for full refund if you cancel now."
          : `No refund for cancellations within ${refundWindowHours} hours.`}
      </p>
    )
  }

  {
    booking.canCancel && (
      <div class="mt-4">
        <CancelClassButton
          client:load
          bookingId={booking.id}
          kstDateLabel={booking.kstDateLabel}
          kstTimeRangeLabel={booking.kstTimeRangeLabel}
          isRefundEligible={booking.isRefundEligible}
          refundWindowHours={refundWindowHours}
        />
      </div>
    )
  }
</article>
