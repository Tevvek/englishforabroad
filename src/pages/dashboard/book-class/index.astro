---
import DashboardPageLayout from "@/layouts/DashboardPageLayout.astro";
import BookingCalendar from "@/components/booking-calendar.tsx";
import { initializeWithServerData } from "@/stores/month-availability.store";
import { getCurrentMonthAvailability } from "./_queries/current-month-availability.query";

// Load current month data server-side for fast initial rendering
const today = new Date();
const { availability, monthData } = await getCurrentMonthAvailability(today);

// Transform to match our nanostore interface
const monthStoreData = {
  availability,
  unavailableDates: monthData.summary.unavailableDates,
};

console.log(monthStoreData);

// Initialize the nanostore with server-side data
initializeWithServerData(today, monthStoreData);
---

<DashboardPageLayout title="Book Class - English for Abroad">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    <div class="mb-8">
      <h1 class="text-3xl font-bold mb-2">Book a Class</h1>
      <p class="text-muted-foreground">
        Schedule your English lesson with one of our experienced teachers
      </p>
    </div>
    <div class="w-min">
      <div>
        <div class="text-lg font-semibold mb-4">
          Select a Date and Time for Your Class
        </div>
        <BookingCalendar client:visible />
      </div>
    </div>
  </div>
</DashboardPageLayout>
