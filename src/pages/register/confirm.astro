---
import Layout from "@/layouts/Layout.astro";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { confirmEmail } from "./_queries/confirm-email.query";

const token = Astro.url.searchParams.get("token");

let confirmationResult: { success: boolean; error?: string } | null = null;

if (token) {
  confirmationResult = await confirmEmail(token);
} else {
  confirmationResult = { success: false, error: "No confirmation token provided" };
}
---

<Layout title="Email Confirmation - English for Abroad">
  <div class="flex min-h-svh w-full items-center justify-center p-6 md:p-10">
    <div class="w-full max-w-md">
      <Card>
        <CardHeader className="text-center">
          {confirmationResult?.success ? (
            <>
              <CardTitle className="text-green-600">Email Confirmed!</CardTitle>
              <CardDescription>
                Your account has been successfully activated
              </CardDescription>
            </>
          ) : (
            <>
              <CardTitle className="text-red-600">Confirmation Failed</CardTitle>
              <CardDescription>
                There was a problem confirming your email
              </CardDescription>
            </>
          )}
        </CardHeader>
        <CardContent className="space-y-4">
          <div class="text-center space-y-2">
            <div class={`w-16 h-16 mx-auto rounded-full flex items-center justify-center ${
              confirmationResult?.success ? 'bg-green-100' : 'bg-red-100'
            }`}>
              {confirmationResult?.success ? (
                <svg
                  class="w-8 h-8 text-green-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
              ) : (
                <svg
                  class="w-8 h-8 text-red-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  ></path>
                </svg>
              )}
            </div>
            
            {confirmationResult?.success ? (
              <p class="text-sm text-muted-foreground">
                You can now sign in to your account and start learning!
              </p>
            ) : (
              <p class="text-sm text-muted-foreground">
                {confirmationResult?.error || "Please check your confirmation link and try again."}
              </p>
            )}
          </div>
          
          <div class="space-y-2">
            {confirmationResult?.success ? (
              <a
                href="/login"
                class="w-full bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2"
              >
                Sign In to Your Account
              </a>
            ) : (
              <div class="space-y-2">
                <a
                  href="/register"
                  class="w-full bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2"
                >
                  Try Registration Again
                </a>
                <a
                  href="/login"
                  class="w-full border border-input bg-background hover:bg-accent hover:text-accent-foreground inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2"
                >
                  Back to Sign In
                </a>
              </div>
            )}
          </div>
        </CardContent>
      </Card>
    </div>
  </div>
</Layout>