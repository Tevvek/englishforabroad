---
import Layout from "./Layout.astro";
import Navbar from "../components/Navbar.astro";
import type { Podcast } from "@/types/resources";
import Footer from "@/sections/Footer.astro";
import Volume from "@/components/Volume.astro";

const { frontmatter } = Astro.props;
const { title, longDescription, image, theme, link } = frontmatter;

const markdowns = await Astro.glob("../pages/resources/podcasts/*.md");
const podcasts = markdowns.map<Podcast>((markdown) => ({
  url: markdown.url!,
  ...(markdown.frontmatter as Omit<Podcast, "url">),
}));
const themedPodcasts = podcasts
  .filter((pd) => pd.theme === theme && pd.title !== title)
  .splice(0, 3);
---

<script>
  import { selectedPodcast } from "@/components/nanostore";
  import { PodcastsThemes } from "@/types/resources";

  const anchor = document.querySelector("a#anchor-theme");
  anchor?.addEventListener("click", (ev) => {
    const themeText = anchor.textContent;
    const theme = Object.values(PodcastsThemes).find(
      (value) => value === themeText
    )!;
    selectedPodcast.set(theme);
  });
</script>

<Layout title=`Ali Enright ESL - ${title} Podcast`>
  <Navbar />

  <main class="bg-[#85CBCC] flex-1">
    <section
      class="2xl:container px-4 md:px-8 py-8 md:py-12 grid grid-cols-3 gap-8"
    >
      <h1 class="text-5xl font-bold mb-4 col-span-3 text-white">{title}</h1>
      <div
        class="bg-white text-cyan-800 rounded-xl p-4 flex gap-x-4 shadow-lg col-span-3"
      >
        <img
          src={image}
          alt={title}
          class="h-64"
          transition:name={title.replaceAll(" ", "")}
        />
        <div class="flex flex-col">
          <a
            id="anchor-theme"
            href="/resources"
            class="w-fit border border-cyan-800 py-0.5 font-semibold text-cyan-800 px-4 rounded-full text-xs transition duration-300 hover:scale-105 shadow self-end"
            >{theme}</a
          >
          <p class="text-sm font-bold">About:</p>
          <p>{longDescription}</p>
          <a
            href={link}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-cyan-800 text-white font-bold rounded-xl px-12 py-2 w-fit transition duration-300 hover:scale-105 shadow mt-6 flex gap-x-2"
            >Listen here <Volume />
          </a>
        </div>
      </div>

      <!-- Similar -->
      <h2 class="text-3xl text-white uppercase col-span-3">Similar podcasts</h2>
      {
        themedPodcasts.map((tpd) => (
          <a
            href={tpd.url}
            class="bg-white text-cyan-800 rounded-xl p-4 h-44 flex gap-x-4 transition duration-300 hover:scale-105 shadow-lg"
          >
            <img
              src={tpd.image}
              alt={title}
              transition:name={tpd.title.replaceAll(" ", "")}
            />
            <div class="flex flex-col gap-y-1">
              <h3 class="font-bold">{tpd.title}</h3>
              <p class="text-sm line-clamp-6">{tpd.shortDescription}</p>
            </div>
          </a>
        ))
      }
    </section>
  </main>

  <Footer />
</Layout>
