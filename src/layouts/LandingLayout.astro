---
import FixedCTA from "@/components/FixedCTA.astro";
import Layout from "./Layout.astro";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<Layout title={title}>
  <FixedCTA
    slot="fixed-cta"
    class="opacity-0 transition-opacity duration-500"
  />
  <slot />
</Layout>

<script>
  const cta = document.querySelector("#calendly-cta")!;
  const hero = document.querySelector("section#hero")!;

  const observer = new IntersectionObserver(
    ([entry]) => {
      if (entry.isIntersecting) {
        // Hero is in view → hide CTA
        cta.classList.add("opacity-0", "pointer-events-none");
      } else {
        // Hero is out of view → show CTA
        cta.classList.remove("opacity-0", "pointer-events-none");
      }
    },
    {
      root: null,
      threshold: 0.6, // small threshold means even a little bit of hero showing will count as visible
    }
  );

  if (hero) {
    observer.observe(hero);
  }
</script>
